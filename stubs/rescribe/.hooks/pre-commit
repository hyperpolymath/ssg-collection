#!/bin/sh
# SPDX-License-Identifier: AGPL-3.0-or-later
# Pre-commit hook for rescribe-ssg
#
# Install: cp .hooks/pre-commit .git/hooks/pre-commit && chmod +x .git/hooks/pre-commit

set -e

echo "üîç Running pre-commit checks..."

# Check for forbidden languages
echo "  Checking language enforcement..."
if find src/ -name "*.py" -o -name "*.ts" -o -name "*.js" 2>/dev/null | grep -q .; then
    echo "‚ùå FORBIDDEN: Non-ReScript files found in src/"
    exit 1
fi
echo "  ‚úÖ Language check passed"

# Build check
echo "  Building..."
cd adapters && npm run build --silent
echo "  ‚úÖ Build passed"

# Lint check (optional, non-blocking)
echo "  Checking format..."
npx rescript format -check src/ 2>/dev/null || echo "  ‚ö†Ô∏è Format issues (non-blocking)"

echo "‚úÖ Pre-commit checks complete"
